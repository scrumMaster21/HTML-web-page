CREATE DATABASE platforma_prosforwn;
USE platforma_prosforwn;


CREATE TABLE user(
    username VARCHAR(50) NOT NULL PRIMARY KEY,
    password VARCHAR(50) NOT NULL,
    email VARCHAR(50) NOT NULL,
    location VARCHAR(50) DEFAULT 'unknown' NOT NULL,
    tokens bigint(16) DEFAULT '0' NOT NULL,
    administrator INT DEFAULT '0' NOT NULL,
    UNIQUE (email)
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE product(
    id_code INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
    stock INT UNSIGNED NOT NULL DEFAULT '0',
    category VARCHAR(50) NOT NULL,
    subcategory VARCHAR(50) NOT NULL,
    price FLOAT(6,2)
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE evaluation(
    username VARCHAR(50) NOT NULL,
    id_code INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) ,
    UNIQUE (name),
    CONSTRAINT a FOREIGN KEY(username) REFERENCES user(username) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT b FOREIGN KEY(id_code) REFERENCES product(id_code) ON DELETE CASCADE ON UPDATE CASCADE
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE offer(
    start_price FLOAT(6,2),
    discount FLOAT(6,2),
    out_of_stock BOOL DEFAULT FALSE NOT NULL,
    likes INT,
    p_date DATE,
    average_price FLOAT(6,2),
    final_price FLOAT(6,2),
    id_2 INT UNSIGNED NOT NULL ,
    username VARCHAR(50) NOT NULL ,
    CONSTRAINT c FOREIGN KEY (username) REFERENCES user(username) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT d FOREIGN KEY (id_2) REFERENCES product(id_code) ON DELETE CASCADE ON UPDATE CASCADE
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE price_history(
    likes INT,
    user_score INT,
    product_name VARCHAR(50),
    price FLOAT(6,2),
    id_2 INT,
    username  VARCHAR(50) NOT NULL,
    id_code INT
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;



CREATE TABLE store(
    name VARCHAR(50) NOT NULL,
    location VARCHAR(50),
    type VARCHAR(50),
    icon VARCHAR(50)
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE tokens(
    num VARCHAR(50) NOT NULL
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;





CREATE TABLE product_history(
    id INT UNSIGNED NOT NULL PRIMARY KEY,
    average_discount FLOAT(6,2) NOT NULL,
    discount_date FLOAT(6,2) NOT NULL ,
    average_price FLOAT(6,2) NOT NULL
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


insert into user (username, password, email , location, tokens, administrator ) values  #edo mporoyme na eisagoyme neous xrhstes me diasyndesh me th selida
                 ('cleogeo', 'upL34r', 'cleom17@gmail.com','Maizonos','2','1'),
                 ('zazahir23', 'zoolhger', 'ahmetTech@yahoo.com','Korinthou','3','0'),
                 ('lionarF', 'erg2378',  'Lionarfre@ezra.co.uk','Ahepa','4','0'),
                 ('liagourma','sionpass','mliagkr@gmail.com','Karaiskaki','6','1'),
                 ('mnikol','m@n0lis' , 'nikolp@gmail.com','Oxford','4','0'),
                 ('abrown','w1lcoxon', 'andrewbr@yahoo.com','General Sklevi',DEFAULT,'0');


insert into product (id_code, stock, category , subcategory ) values  #edo mporoyme na eisagoyme nea proionta me diasyndesh me th selida
                    (NULL, '4', 'CHESSE', 'JKDVNJVN'),
                    (NULL, '5', 'CHESSE', 'SJDVDSJVNDS'),
                    (NULL, '7', 'CANDY',  'DSNDSNDVND'),
                    (NULL, '8', 'MILK',  'DDJSKDVJK'),
                    (NULL, '150','BURGER', 'JKDDJSKJ');

insert into evaluation ( username) values  #edo mporoyme na eisagoyme nees ajiologhseis me diasyndesh me th selida
                       ('cleogeo'),
                       ('zazahir23'),
                       ('lionarF'),
                       ('liagourma'),
                       ('abrown');



/* edo 8a ftiajo mia synarthsh gia na elenxo an o kodikos poy do8hke exei kapoious xarakthres san #,__,@ ktl dioti aytoi oi xarakthres mporoun na vlacoun th bash moy*/
DELIMITER $
CREATE PROCEDURE password_control (IN password varchar(50), OUT G INT,OUT H INT)

BEGIN

DECLARE F varchar(50) ;
SET F=password;



IF (F LIKE '%________%' ) THEN
   SET H=1;
ELSE SET H=0;
END IF;
 
IF ((F LIKE '%#%') OR (F LIKE '%@%') OR (F LIKE '%$%') OR (F LIKE '%&%') OR (F LIKE '%*%')) THEN
   SET G=1;
ELSE SET G=0;
END IF;



END $
DELIMITER ;

CALL password_control('SDDSFF',@G,@H);
